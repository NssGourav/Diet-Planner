// This is your Prisma schema file
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id            String         @id @default(auto()) @map("_id") @db.ObjectId
  email         String         @unique
  password      String
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  
  meals         Meal[]
  dailyGoals    DailyGoal?
  loggedMeals   LoggedMeal[]
  plannedMeals  PlannedMeal[]
  customFoods   CustomFood[]
  
  @@map("users")
}

model Meal {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  userId       String   @map("user_id") @db.ObjectId
  name         String
  calories     Float
  protein      Float
  carbs        Float
  fat          Float
  plannedDate  DateTime? @map("planned_date")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("meals")
}

model DailyGoal {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @unique @map("user_id") @db.ObjectId
  calories  Float
  protein   Float
  carbs     Float
  fat       Float
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("daily_goals")
}

model LoggedMeal {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  userId       String   @map("user_id") @db.ObjectId
  name         String
  calories     Float
  protein      Float
  carbs        Float
  fat          Float
  quantity     Float    @default(100) // Current serving size in grams
  baseQuantity Float    @default(100) @map("base_quantity") // Original reference serving size
  mealDate     DateTime @map("meal_date")
  loggedAt     DateTime @default(now()) @map("logged_at")
  
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("logged_meals")
}

model CustomFood {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @map("user_id") @db.ObjectId
  name      String
  calories  Float
  protein   Float
  carbs     Float
  fat       Float
  createdAt DateTime @default(now()) @map("created_at")
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("custom_foods")
}

model PlannedMeal {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  userId       String   @map("user_id") @db.ObjectId
  name         String
  calories     Float?
  protein      Float?
  carbs        Float?
  fat          Float?
  plannedDate  DateTime @map("planned_date")
  mealType     String   @map("meal_type")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("planned_meals")
}
